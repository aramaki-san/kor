dist: trusty
sudo: required

env:
  matrix:
    - MOZ_HEADLESS=1
    - HEADLESS=true
    - DATABASE_URL=mysql2://travis@localhost/kor_test?encoding=utf8&collation=utf8_general_ci

addons:
  chrome: stable

services:
  - mysql
  - elasticsearch

before_install:
  - sudo apt-get -qq update
  - sudo apt-get install libav-tools imagemagick
  - curl -O https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-5.6.12.deb 
  - sudo dpkg -i --force-confnew elasticsearch-5.6.12.deb
  - sudo service elasticsearch restart
  # - wget -N https://github.com/mozilla/geckodriver/releases/download/v0.20.1/geckodriver-v0.20.1-linux64.tar.gz -O geckodriver.tar.gz
  # - tar xzf geckodriver.tar.gz
  # - rm geckodriver.tar.gz
  # - chmod +x geckodriver
  # - sudo mv geckodriver /usr/local/bin/geckodriver
  - nvm install v8.12.0
  - nvm alias default v8.12.0

install:
  - npm install
  - bundle install --jobs=3 --retry=3 --deployment
  - npm run build

script:
  - mysql -e 'CREATE DATABASE kor_test;'
  - bundle exec rake db:test:load
  - bundle exec rspec spec/ --format=documentation
  - bundle exec cucumber features/ --format=documentation
